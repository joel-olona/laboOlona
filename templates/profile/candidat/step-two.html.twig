{% extends 'base.html.twig' %}

{% block body %}
    <section id="step-two" class="" style="background-color: black;">
        <div class="container">
            <h1 class="h1 text-center pt-4 text-white font-bold">
                {{ 'app_identity_expert_step_two.title'|trans }}
            </h1>
            {{ form_start(form, {'attr': {'class': 'form-inline' }}
            ) }}
            {{ form_errors(form) }}
                    
            <div class="row text-white">
                <div class="col-md-6 offset-md-3">
                    <hr class="my-2 mb-4">

                        <div class="row mb-4">
                            {{ form_label(form.titre) }}
                            {{ form_errors(form.titre) }}
                            <div class="col-sm-8">
                                {{ form_widget(form.titre, {'attr': {'class': 'rounded-pill' }}
                                ) }}
                                                    
                            </div>
                        </div>

                        <div class="row mb-4">
                            {{ form_label(form.resume) }}
                            {{ form_errors(form.resume) }}
                            <div class="col-sm-8 text-black">
                                {{ form_widget(form.resume, {'attr': {'class': 'rounded' }}
                                ) }}
                                                    
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-sm-4">
                                {{ form_label(form.secteurs) }}
                                {{ form_errors(form.secteurs) }}
                            </div>
                            <div class="col-sm-8">
                                {{ form_widget(form.secteurs) }}                                                    
                            </div>
                        </div>

                    </div>
                </div>
                
                <div class="col-md-6 offset-md-3">
                    <div class="row mb-4">
                        {{ form_label(form.tarifCandidat) }}
                        <div class="col-sm-8 d-flex">
                        {{ form_widget(form.tarifCandidat.typeTarif, {'attr': {'class': 'custom-rounded-start', 'style':'width:33%'}}) }}
                        {{ form_widget(form.tarifCandidat.montant, {'attr': {'class': 'custom-rounded-middle', 'style':'width:33%'}}) }}
                        {{ form_widget(form.tarifCandidat.devise, {'attr': {'class': 'custom-rounded-end', 'style':'width:33%'}}) }}
                        </div>
                    </div>
                </div>

                <div class="col-md-6 offset-md-3">
                    <div class="row mb-4">
                        <div class="col-md-4 col-12 text-center mb-2 mb-md-0">
                            {{ 'app_identity_expert_step_two.experience.name'|trans }} *
                        </div>
                        
                        <div class="col-md-5 col-12">
                            <div {{ stimulus_controller('form-collection') }} data-form-collection-index-value="{{ form.experiences|length > 0 ? form.experiences|last.vars.name + 1 : 0 }}" data-form-collection-prototype-value="{{ form_widget(form.experiences.vars.prototype)|e('html_attr') }}">
                                <!-- Modal -->
                                <div class="modal fade" id="experience" tabindex="-1" aria-labelledby="experienceLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content text-black">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-2" id="experienceLabel">
                                                    {{ 'app_identity_expert_step_two.experience.add'|trans }}
                                                </h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <ul {{ stimulus_target('form-collection', 'collectionContainer') }}>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-light rounded-pill small w-100" data-bs-toggle="modal" data-bs-target="#experience" type="button" {{ stimulus_action('form-collection', 'addCollectionElement') }}>
                                    <i class="h5 bi mx-1 bi-plus"></i>
                                    {{ 'app_identity_expert_step_two.experience.add'|trans }}
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3 col-12 text-md-end text-center mt-2 mt-md-0">
                            <button type="button" class="btn btn-light rounded-pill small position-relative" data-bs-toggle="modal" data-bs-target="#experiencesPreview">
                                Aperçu <i class="h5 bi mx-1 bi-eye"></i>
                                {% if experiences|length > 0 %}
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        {{ experiences|length }}
                                        <span class="visually-hidden">Compétences ajoutées</span>
                                    </span>
                                {% endif %}
                            </button>
                        </div>
                    </div>
                </div>



                <div class="col-md-6 offset-md-3">
                    <div class="row mb-4">
                        <div class="col-md-4 col-12 text-center mb-2 mb-md-0">
                            {{ 'app_identity_expert_step_two.skill.name'|trans }} *
                        </div>
                        <div class="col-md-5 col-12">
                            <div {{ stimulus_controller('form-collection') }} data-form-collection-index-value="{{ form.competences|length > 0 ? form.competences|last.vars.name + 1 : 0 }}" data-form-collection-prototype-value="{{ form_widget(form.competences.vars.prototype)|e('html_attr') }}">
                                <!-- Modal -->
                                <div class="modal fade" id="technicalSkill" tabindex="-1" aria-labelledby="technicalSkillLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content text-black">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-2" id="technicalSkillLabel">
                                                    {{ 'app_identity_expert_step_two.skill.add'|trans }}
                                                </h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <ul {{ stimulus_target('form-collection', 'collectionContainer') }}></ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-light rounded-pill small w-100" data-bs-toggle="modal" data-bs-target="#technicalSkill" type="button" {{ stimulus_action('form-collection', 'addCollectionElement') }}>
                                    <i class="h5 bi mx-1 bi-plus"></i>
                                    {{ 'app_identity_expert_step_two.skill.add'|trans }}
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3 col-12 text-md-end text-center mt-2 mt-md-0">
                            <button type="button" class="btn btn-light rounded-pill small position-relative" data-bs-toggle="modal" data-bs-target="#skillsPreview">
                                Aperçu <i class="h5 bi mx-1 bi-eye"></i>
                                {% if competences|length > 0 %}
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        {{ competences|length }}
                                        <span class="visually-hidden">Compétences ajoutées</span>
                                    </span>
                                {% endif %}
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 offset-md-3">
                    <div class="row mb-4">
                        <div class="col-md-4 col-12 text-center mb-2 mb-md-0">
                            {{ 'app_identity_expert_step_two.language.name'|trans }} *
                        </div>
                        <div class="col-md-5 col-12">
                            <div {{ stimulus_controller('form-collection') }} data-form-collection-index-value="{{ form.langages|length > 0 ? form.langages|last.vars.name + 1 : 0 }}" data-form-collection-prototype-value="{{ form_widget(form.langages.vars.prototype)|e('html_attr') }}">
                                <!-- Modal -->
                                <div class="modal fade" id="language" tabindex="-1" aria-labelledby="languageLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content text-black">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-2" id="languageLabel">
                                                    {{ 'app_identity_expert_step_two.language.add'|trans }}
                                                </h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <ul {{ stimulus_target('form-collection', 'collectionContainer') }}></ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-light rounded-pill small w-100" data-bs-toggle="modal" data-bs-target="#language" type="button" {{ stimulus_action('form-collection', 'addCollectionElement') }}>
                                    <i class="h5 bi mx-1 bi-plus"></i>
                                    {{ 'app_identity_expert_step_two.language.add'|trans }}
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3 col-12 text-md-end text-center mt-2 mt-md-0">
                            <button type="button" class="btn btn-light rounded-pill small position-relative" data-bs-toggle="modal" data-bs-target="#languagesPreview">
                                Aperçu <i class="h5 bi mx-1 bi-eye"></i>
                                {% if langages|length > 0 %}
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        {{ langages|length }}
                                        <span class="visually-hidden">Compétences ajoutées</span>
                                    </span>
                                {% endif %}
                            </button>
                        </div>
                    </div>
                </div>


                

                <div class="col-md-6 offset-md-3">
                        <div class="row mb-4">
                            {{ form_label(form.cv) }}
                            <div class="col-sm-8">
                                {{ form_widget(form.cv, {'attr': {'class': 'rounded-pill' }}
                                ) }}
                        
                            {{ form_errors(form.cv) }}
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display:none;">
                    {{ form_widget(form) }}
                </div>
                <hr class="my-4">
                <div class="d-flex flex-column flex-sm-row justify-content-center">
                    <a href="{{ path('app_profile_candidate_step_one')}}" id="cancel" class="btn btn-outline-dark rounded-pill mx-2 mb-3">
                        {{ 'app_identity_expert_step_two.cancel'|trans }}
                    </a>
                    <button type="submit" id="submitForm" class="btn btn-primary rounded-pill mx-2 mb-3" onclick="submitFormAndRedirect()">
                        {{ 'app_identity_expert_step_two.button'|trans }}
                    </button>
                </div>
                <div class="d-flex justify-content-center">
                    <a href="{{ path('app_dashboard_candidat_compte')}}" id="cancel" class="text-light my-3 small">
                        <i class="bi bi-info-circle h5"></i>  Vous pouvez toujours modifier les infos dans votre espace personnelles
                    </a>
                </div>
                <hr class="my-4">
                {{ form_end(form) }}
                <div class="col-md-6 offset-md-4 text-white">
                    {% include "dashboard/_inner_footer_light.html.twig" %}
                </div>
            </div>
        </div>
    </section>

    <!-- Modal -->
    <div class="modal fade" id="experiencesPreview" tabindex="-1" aria-labelledby="experiencesPreviewLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content text-black">
                <div class="modal-header">
                    <h1 class="modal-title fs-2" id="experiencesPreviewLabel">
                        {{ 'app_identity_expert_step_two.experience.all'|trans }}
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                {% if experiences|length > 0 %}
                    {% for experience in experiences %}
                        <p class="text-dark small d-flex justify-content-between align-items-center mb-0">
                            <span>
                            <strong>{{ experience.nom }}</strong>
                            | 
                            <strong>{{ experience.entreprise }}</strong>
                            | 
                            {{ date_difference(experience.dateFin, experience.dateDebut) }}
                        </span>
                            <button class="btn btn-sm btn-dark rounded-circle p-1 lh-1" type="button" data-id="{{ experience.id}}" data-user="{{ user.id}}" data-href="/ajax-remove-experience/{{ experience.id }}/{{ user.id }}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </p>
                        <p class="text-dark small d-flex justify-content-between align-items-left">
                            {{ experience.description|raw }}
                        </p>
                    {% endfor %}
                {% else %}
                    <p class="text-dark small">
                        Aucune 
                    </p>
                {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="skillsPreview" tabindex="-1" aria-labelledby="skillsPreviewLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content text-black">
                <div class="modal-header">
                    <h1 class="modal-title fs-2" id="skillsPreviewLabel">
                        {{ 'app_identity_expert_step_two.skill.all'|trans }}
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if competences is not empty %}
                        {% for technicalSkill in competences %}
                            <div class="text-dark small d-flex justify-content-between align-items-center">
                                <span class="text-strong">{{ technicalSkill.nom }}</span>
                                <span class="d-flex align-items-center">
                                    <span class="mx-4 p-1 lh-1">
                                        {% for i in 1..5 %}
                                            {% if i <= technicalSkill.note %}
                                                <i class="small bi bi-star-fill text-warning"></i>
                                            {% else %}
                                                <i class="small bi bi-star text-dark"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                    
                                    <button class="btn btn-sm btn-dark rounded-circle p-1 lh-1" type="button" data-id="{{ technicalSkill.id}}" data-user="{{ user.id}}" data-href="/ajax-remove-competence/{{ technicalSkill.id }}/{{ user.id }}">
                                        <i class="bi bi-trash"></i>
                                    </button> 
                                </span>
                            
                            </div>
                            <div class="text-dark small d-flex justify-content-between align-items-left">
                                <div class="">{{ technicalSkill.description|raw }}<hr></div> 
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-light small">
                            Aucune 
                        </p>
                    {% endif %}                
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="languagesPreview" tabindex="-1" aria-labelledby="languagesPreviewLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content text-black">
                <div class="modal-header">
                    <h1 class="modal-title fs-2" id="languagesPreviewLabel">
                        {{ 'app_identity_expert_step_two.language.all'|trans }}
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if langages is not empty %}
                        {% for language in langages %}
                            <p class="text-dark small d-flex justify-content-between align-items-center">
                                {{ language.langue.nom }}
                                <span class="d-flex align-items-center">
                                    <span class="mx-4 p-1 lh-1">
                                        {% for i in 1..5 %}
                                            {% if i <= language.niveau %}
                                                <i class="small bi bi-star-fill text-warning"></i>
                                            {% else %}
                                                <i class="small bi bi-star text-dark"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                    
                                    <button class="btn btn-sm btn-dark rounded-circle p-1 lh-1" type="button" data-id="{{ language.id}}" data-user="{{ user.id}}" data-href="/ajax-remove-language/{{ language.id }}/{{ user.id }}">
                                        <i class="bi bi-trash"></i>
                                    </button> 
                                </span>                            
                            </p>
                        {% endfor %}
                    {% else %}
                        <p class="text-light small">
                            Aucune 
                        </p>
                    {% endif %}                
                </div>
            </div>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="{{ asset('assets/ckeditor5/ckeditor.js')}}"></script>
<script>
    ClassicEditor.create( document.querySelector( '#step_two_resume' ) )
    $(document).ready(function () {
        $('[data-id]').click(function () {
            const experienceId = $(this).data('id');
            const userId = $(this).data('user');
            const href = $(this).data('href');
            console.log(experienceId, userId, href)
            // Envoyez une requête Ajax pour supprimer l'expérience
            $.ajax({
                type: 'POST',
                url: `${href}`,
                success: function (data) {
                    // Gérez la réponse ici (par exemple, actualisez la page ou supprimez l'élément de la liste)
                    console.log(data);
                    location.reload();
                },
                error: function (error) {
                    console.error('Erreur lors de la suppression de l\'expérience', error);
                }
            });
        });
    });
</script>

<script>  


    document.addEventListener('DOMContentLoaded', function() {
        const fileInputElement = document.querySelector('.custom-file-input');
    
        if (fileInputElement) {
            fileInputElement.addEventListener('change', function() {
                var fileName = this.value.split('\\').pop();
                this.nextElementSibling.textContent = fileName ? fileName : 'Importer un fichier';
            });
        }
    });


</script>
{% endblock %}
            